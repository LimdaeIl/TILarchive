# 섹션1. 웹 애플리케이션 이해



## 웹 서버와 웹 애플리케이션 서버

**1. 웹 서버 (Web Server)**

- 정적 리소스 제공

**2. 웹 애플리케이션 서버 (WAS)**

- 웹 서버의 기능 포함 (정적 리소스)
- 프로그램 코드를 실행해서 애플리케이션 로직 수행
- 동적 html, JSON (RestController)
- ex. tomcat, jetty 등 ...

**3. 웹 서버 VS 웹 애플리케이션 서버**

- 가장 큰 차이점은 웹서버는 정적 리소스를 포함하고
  웹 애플리케이션 서버는 동적 리소스를 포함한다는 것이다.
- WAS 또한 웹 서버의 기능을 제공 + 프로그래밍 실행 기능 포함이기 때문에 2개를 구분하기는 힘들다.
- 하지만 WAS는 Application 로직을 실행하는데 더 특화되어 있다.

## 웹 서비스 구성

**1. WAS + DataBase**

- was는 정적 + 동적 리소스를 모두 제공하게 된다.
- 이렇게 되면 was가 너무 많은 일을 담당한다. -> 서버 과부하
- 단점
  - was가 죽으면 정적 리소스도 수행하기 어려워 오류화면 조차 보이지 않는다.

**2. Web Server + Was + DataBase**

> client - web server - was - db
>
> - web server
>   - 정적 리소스 처리
>   - 애플리케이션 로직 (동적 리소스) 는 was에게 위임
> - was
>   - 중요한 작업 (동적 리소스) 할당

- 장점
  - was에 오류가 나도 에러 페이지는 띄울 수 있다.

**보통 API를 제공 -> WAS 서버만 구축하면 된다.**

## 서블릿

client 에서 요청이 오면 서블릿 코드가 실행 된다.

- HttpServlet 상속 받아 servicce(HttpServletRequest, HttpServletResponse) 메서드 오버라이드

**전체적인 동작 방식**

- client 요청 > was > 서블릿 컨테이너(서블릿 코드 실행) > 응답

## 서블릿 컨테이너

- 서블릿 객체 자동 생성, 호출, 종료
- 서블릿 객체의 생명주기 담당 (서블릿 객체 = singleton 유지)
- 서블릿을 지원하는 was를 의미 (ex. tomcat)
- 동시 요청을 위한 멀티스레드를 지원

## 동시 요청 - 멀티스레드

client 요청이 오면 was의 서블릿 객체를 호출한다.

❓ 누가 서블릿 객체를 호출할까

❗️ 쓰레드가 호출한다

즉, client에서 요청이 오면 쓰레드가 할당되어 서블릿 객체를 호출한다.

**1. 요청마다 쓰레드 생성**

**장점**

- 동시 요청 시, 자원(CPU, 메모리)이 허용하는 범위까지 처리 가능
- 하나의 쓰레드가 지연되도 다른 쓰레드에 영향을 미치지 않는다.

**단점**

- 쓰레드 생성 비용이 비싸다.
- context switching 비용 발생한다.
  - cpu는 여러 쓰레드를 번갈아가며 수행한다.
  - 따라서 쓰레드가 변경될때 발생되는 비용을 의미한다
- 동시 요청이 많이 발생하게 되면 쓰레드 생성에 제한이 없으므로 CPU 및 메모리 임계점이 넘어가면서 서버가 다운된다.

**해결 방법**

- was는 내부의 쓰레드 풀이 존재한다.

**Thread Pool 동작 방식**

- 요청이 오면 쓰레드 풀에게 요청을 하고 요청이 끝나면 쓰레드 풀에 해당 쓰레드를 반납한다.

**Thread Pool 장점**

- 쓰레드 풀안에 200개 쓰레드 존재
- 요청이 205번
- 200개를 쓰레드 풀에서 사용
- 나머지 5개의 요청에 대해서는 대기 (대기열 생성) OR 거절